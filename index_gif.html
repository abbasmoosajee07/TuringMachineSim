<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Turing Machine Simulator</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
        <!-- Ace Editor CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.6/ace.min.css">
        <link rel="stylesheet" href="turing_gui/styles.css">
    </head>

    <body>
        <!-- Control button -->
        <button id="ControlBtn" class="control-btn bi bi-play-fill"></button>

        <!-- Title and Model Drop Down -->
        <div class="container mt-4">
            <h1 class="text-center mb-4">Turing Machine Simulator</h1>
        </div>

        <!-- Main GUI-->
        <div class="container mt-4">
            <!-- Ticker Tape & Controls Card -->
            <div class="card mt-4 shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span class="fw-bold">Ticker Tape</span>
                    <div class="gif-controls d-flex align-items-center gap-2">
                        <button id="buildGIF" class="btn btn-buildgif w-100 action-btn bi bi-camera-reels-fill"> Build GIF</button>
                    </div>
                </div>

                <div class="card-body">
                    <!-- Tape Display -->
                    <div class="tape-wrapper border rounded p-3 bg-light mb-3">
                        <div id="tapeDisplay" class="tape-container"></div>
                    </div>

                    <!-- Machine Status -->
                    <div id="machineStatus" class="machineStatus fw-bold text-center text-secondary mb-3"></div>

                    <!-- History Slider -->
                    <div class="d-flex align-items-center gap-2 mb-2">
                        <label for="historySlider" class="form-label mb-0 text-nowrap">History:</label>
                        <input type="range" class="slider-primary form-range flex-grow-1" id="historySlider" min="0" max="0" value="0">
                    </div>

                    <!-- Step Info -->
                    <div id="stepState" class="step-state text-center text-muted small"></div>
                </div>
            </div>

            <!-- GIF Preview Card -->
            <div id="gifCard" class="card mt-4 shadow-sm" style="display: none;">
                <div class="card-header">Tape GIF</div>

                <div class="card-body">
                    <!-- Configuration + Actions -->
                    <div class="row g-2 align-items-center justify-content-center mb-3">

                        <!-- Delay -->
                        <div class="col-auto d-flex align-items-center">
                            <label for="gifSpeed" class="me-1 mb-0 small">Delay(ms):</label>
                            <input type="number" id="gifSpeed" class="form-control text-center"
                                style="width: 60px; height: 24px; padding: 0 4px; font-size: 12px;"
                                min="50" max="5000" step="50" value="500">
                        </div>

                        <!-- BG Color -->
                        <div class="col-auto d-flex align-items-center">
                            <label for="gifColor" class="me-1 mb-0 small">GIF Color:</label>
                            <input type="color" id="gifColor" class="form-control form-control-color p-0"
                                style="width: 28px; height: 24px;" value="#fd490d">
                        </div>

                        <!-- Cells -->
                        <div class="col-auto d-flex align-items-center">
                            <label for="visibleCells" class="me-1 mb-0 small">Cells No:</label>
                            <input type="number" id="visibleCells" class="form-control text-center"
                                style="width: 50px; height: 24px; padding: 0 4px; font-size: 12px;"
                                min="1" max="99" value="15">
                        </div>

                        <!-- Resolution -->
                        <div class="col-auto d-flex align-items-center">
                            <label for="resolution" class="me-1 mb-0 small">Resolution:</label>
                            <input type="number" id="resolution" class="form-control text-center"
                                style="width: 50px; height: 24px; padding: 0 4px; font-size: 12px;"
                                min="1" max="99" value="2">
                        </div>

                        <!-- Buttons -->
                        <div class="col-auto d-flex flex-column justify-content-end h-100">
                            <button id="generateGIF" class="btn btn-rendergif w-100 action-btn">
                                <i class="bi bi-film"></i> Render
                            </button>
                        </div>
                        <div class="col-auto d-flex flex-column justify-content-end h-100">
                            <a id="downloadGIF" class="btn btn-savegif w-100 action-btn" download="turing-machine.gif">
                                <i class="bi bi-filetype-gif"></i> Save
                            </a>
                        </div>
                        <div class="col-auto d-flex flex-column justify-content-end h-100">
                            <button id="cancelGIF" class="btn btn-cancelgif w-100 action-btn">
                                <i class="bi bi-x-circle-fill"></i> Cancel
                            </button>
                        </div>
                    </div>

                    <!-- GIF Preview -->
                    <div id="gifContainer" class="text-center" style="display: none;">
                        <div class="preview-image mb-2">
                            <img id="gifPreview" class="img-fluid border rounded shadow-sm"
                                alt="GIF Preview">
                        </div>
                    </div>

                    <!-- Status Area -->
                    <div class="text-center mb-3">
                        <div id="GIFStatus" class="machineStatus text-medium"></div>
                    </div>
                </div>
            </div>

            <!-- Controls and Configuration -->
            <div class="row mt-3 align-items-stretch">
                <!-- Configure Model -->
                <div class="col-md-8 mb-2">
                    <div class="card h-100">
                        <div class="card-header d-flex align-items-center justify-content-between">
                            <span>Configure Model</span>
                            <input type="text" id="modelInputName"
                                class="form-control form-control-sm ms-2 fst-italic"
                                placeholder="turing_test..."
                                style="max-width: 200px; font-style: italic;">
                        </div>

                        <div class="card-body">
                            <!-- Transition Rules -->
                            <div class="mb-3 flex-grow-1">
                                <label for="rulesEditor" class="form-label">Transition Rules:</label>
                                <div id="rulesEditor" class="form-control h-100" style="min-height: 250px; white-space: pre-wrap;">// turing_test: unary increment
INIT | FIND | R
FIND | FIND | R
FIND _ HALT | L</div>
                            </div>

                            <!-- Initial Tape -->
                            <div class="mb-3">
                                <label for="tapeInput" class="form-label">Initial Tape:</label>
                                <input type="text" id="tapeInput" class="form-control" value="||||">
                            </div>

                            <!-- Action Buttons -->
                            <div class="row mb-0 g-2 mt-auto">
                                <div class="col-3">
                                    <button id="clearRulesBtn" class="btn btn-clear w-100 action-btn bi bi-trash-fill"> Clear</button>
                                </div>
                                <div class="col-3">
                                    <input type="file" id="fileInput" accept=".txt" style="display: none;">
                                    <button id="uploadBtn" class="btn btn-upload w-100 action-btn bi bi-file-earmark-arrow-up"> Upload</button>
                                </div>
                                <div class="col-3">
                                    <button id="copyRulesBtn" class="btn btn-copy w-100 action-btn bi bi-clipboard-fill"> Copy</button>
                                </div>
                                <div class="col-3">
                                    <button id="saveBtn" class="btn btn-save w-100 action-btn bi bi-save"> Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Control Machine -->
                <div class="col-md-4 mb-2">
                    <div class="card h-100">
                        <div class="card-header">Control Machine</div>
                        <div class="card-body d-flex flex-column">
                            <!-- Step Navigation -->
                            <div class="mb-3">
                                <div class="row align-items-center g-2">
                                    <div class="col-4">
                                        <label for="gotoStep" class="form-label mb-0 w-100">Seek Step:</label>
                                    </div>
                                    <div class="col-4">
                                        <input type="number" id="gotoStep" class="form-control" min="0" title="Seek specific step in history">
                                    </div>
                                    <div class="col-4">
                                        <button class="btn btn-goto w-100 action-btn bi bi-signpost-fill" id="gotoBtn">Seek</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Configuration Options -->
                            <div class="mb-3">
                                <label for="stepEntry" class="form-label">Jump Steps:</label>
                                <input type="number" id="stepEntry" class="form-control" value="1" min="1" title="Steps per jump">
                            </div>

                            <div class="mb-3">
                                <label for="maxSteps" class="form-label">Max Steps:</label>
                                <input type="number" id="maxSteps" class="form-control" value="1000000" min="1" title="Max steps">
                            </div>

                            <div class="mb-3">
                                <label for="delayEntry" class="form-label">Speed (ms):</label>
                                <input type="number" id="delayEntry" class="form-control" value="300" min="1" title="Step delay (ms)">
                            </div>

                            <!-- Control Buttons -->
                            <div class="row mb-3 g-2 mt-auto">
                                <div class="col-4">
                                    <button id="stepBtn" class="btn btn-step w-100 action-btn bi bi-skip-forward-fill">Jump</button>
                                </div>
                                <div class="col-4">
                                    <button id="RunPauseBtn" class="btn btn-runpause w-100 action-btn bi bi-play-fill">Play</button>
                                </div>
                                <div class="col-4">
                                    <button id="resetBtn" class="btn btn-reset w-100 action-btn bi bi-arrow-clockwise">Reset</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model Results -->
            <div class="card mt-3">
                <div class="card-header">Model Summary</div>
                <div class="card-body">
                    <div id="results" class="monospace"></div>
                    <div id="resources" class="monospace mt-2"></div>
                </div>
            </div>

            <!-- Help Card -->
            <div class="card mt-3" id="helpCard">
                <div class="card-body">
                    <div class="row">
                        <!-- Column 1: About Turing Machines -->
                        <div class="col-md-4 mb-4">
                            <h5 class="mb-3">üìñ What is a Turing Machine?</h5>
                            <p class="small text-muted">
                                A Turing Machine is a theoretical computing model proposed by Alan Turing. It manipulates symbols on an infinite tape according to a set of rules. Despite its simplicity, it can simulate the logic of any algorithm.
                            </p>
                            <p class="small text-muted">
                                It consists of:
                                <ul class="small text-muted ps-3">
                                    <li>A tape (memory)</li>
                                    <li>A head (reads/writes)</li>
                                    <li>A state machine (set of instructions)</li>
                                </ul>
                            </p>
                            <p class="small mb-0">
                                <a href="https://en.wikipedia.org/wiki/Turing_machine" target="_blank" class="text-decoration-none">
                                    <i class="bi bi-box-arrow-up-right me-1"></i> Learn more
                                </a>
                            </p>
                        </div>

                        <!-- Column 2: Instructions -->
                        <div class="col-md-5 mb-4">
                            <h5 class="mb-3">üõ† Try It Out</h5>
                            <p class="small text-muted">
                                Define your machine using <strong>transition rules</strong> and provide an input tape. You can run the machine step-by-step or automatically.
                            </p>
                            <h6 class="small text-dark">üßæ Rule Format</h6>
                            <pre class="bg-light p-2 rounded small"><code>[currentState] [currentSymbol] [newState] [newSymbol] [Dir]</code></pre>
                            <p class="small text-muted">Example: <code>INIT 0 WRITE 1 R</code></p>

                            <h6 class="small text-dark mt-3">üîÅ Move Directions</h6>
                            <ul class="small text-muted ps-3">
                                <li><code>L</code> - Move Left</li>
                                <li><code>R</code> - Move Right</li>
                            </ul>
                        </div>

                        <!-- Column 3: Configuration & Limits -->
                        <div class="col-md-3 mb-4">
                            <h5 class="mb-3">‚öôÔ∏è Machine Configuration</h5>
                            <ul class="list-unstyled small text-muted">
                                <li>‚Ä¢ Blank Symbol: <code>'<span id="blankSymbolPlaceholder"></span>'</code></li>
                                <li>‚Ä¢ Initial State: <code>'<span id="initStatePlaceholder"></span>'</code></li>
                                <li>‚Ä¢ Halt State: <code>'<span id="haltStatePlaceholder"></span>'</code></li>
                            </ul>

                            <h6 class="small text-dark mt-3">üö¶ Limits</h6>
                            <ul class="list-unstyled small text-muted">
                                <li>‚Ä¢ Max States: <span id="maxStatesPlaceholder"></span></li>
                                <li>‚Ä¢ Max Tape Length: <span id="maxTapeLenPlaceholder"></span></li>
                                <li>‚Ä¢ Max State Name: <span id="maxStateSizePlaceholder"></span> characters</li>
                                <li>‚Ä¢ Max Rules: <span id="transitionSizePlaceholder"></span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- JavaScript Libraries -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.6/ace.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.6/ext-language_tools.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

        <!-- Main Application Script -->
        <script type="module">
            import { TuringConfig, MachineLogic } from './javascript_machine/TuringBrain.js';
            import { Simulator_GUI } from './javascript_machine/Simulator_GUI.js';
            import { GIFBuilder } from './turing_gui/GIFBuilder.js';

            window.TuringConfig = TuringConfig;
            window.MachineLogic = MachineLogic;
            window.Simulator_GUI = Simulator_GUI;

            // Initialize Ace Editor
            const editor = ace.edit("rulesEditor");
            editor.setTheme("ace/theme/KatzenMilch");
            editor.session.setMode("ace/mode/text");
            editor.setOptions({
                fontSize: "14px",
                showLineNumbers: true,
                showGutter: true,
                cursorStyle: "ace",
                highlightActiveLine: true,
                enableBasicAutocompletion: true,
                enableLiveAutocompletion: true
            });

            // Make editor available globally
            window.getRulesText = () => editor.getValue();
            window.setRulesText = (text) => editor.setValue(text);

            // Initialize GU
            new Simulator_GUI();

            // Populate help section
            document.getElementById('initStatePlaceholder').textContent = TuringConfig.INIT_STATE;
            document.getElementById('haltStatePlaceholder').textContent = TuringConfig.HALT_STATE;
            document.getElementById('blankSymbolPlaceholder').textContent = TuringConfig.BLANK;
            document.getElementById('maxStatesPlaceholder').textContent = TuringConfig.MAX_STATES.toLocaleString();
            document.getElementById('maxTapeLenPlaceholder').textContent = TuringConfig.MAX_TAPE_LEN.toLocaleString();
            document.getElementById('maxStateSizePlaceholder').textContent = TuringConfig.MAX_STATE_SIZE;
            document.getElementById('transitionSizePlaceholder').textContent = TuringConfig.TRANSITION_SIZE.toLocaleString();

        </script>

        <!-- Footer -->
        <footer class="text-center py-2 mt-5 bg-light border-top small text-muted">
            <div class="container">
                <div class="mb-2">
                    &copy; <span id="year"></span> Abbas Moosajee &nbsp;|&nbsp;
                    <a href="https://github.com/abbasmoosajee07/TuringMachineSim" target="_blank" title="View on GitHub" class="text-dark text-decoration-none">
                        <i class="bi bi-github align-middle"></i> GitHub
                    </a>
                    &nbsp;|&nbsp; MIT License
                </div>
            </div>
        </footer>

    </body>

</html>
